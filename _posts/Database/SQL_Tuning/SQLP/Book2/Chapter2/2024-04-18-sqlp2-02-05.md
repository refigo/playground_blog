---
title: <오라클 성능 고도화 원리와 해법2> Ch02-05 Outer 조인
date: 2024-04-18
categories: [Database, SQL Tuning]
tags: [SQLP]
---

## 오라클 성능 고도화 원리와 해법2 - Ch02-05 Outer 조인

### (1) Outer NL 조인

NL 조인은 그 특성상 Outer 조인할 때 방향이 한쪽으로 고정되며, Outer 기호(+)가 붙지 않은 테이블이 항상 드라이빙 테이블로 선택된다. leading 힌트를 이용해 순서를 바꿔보려 해도 소용 없다.

![](/assets/images/sqlp/sqlp2-02-05-1-sql1.png)

4절에서 보았듯이 NL 조인이 조인 순서에 가장 큰 영향을 받는다. 조인 순서 때문에 성능이나 빠지지 않게 하려면 불필요한 Outer 조인이 발생하지 않도록 주의해야 한다.

#### ERD 표기를 따르는 SQL 개발의 중요성

데이터베이스 프로그래머에게는 BRD 표기법에 대한 정확한 이해가 필수적이다. BIRD를 잘못 해석하면 설계 의도와 다른 데이터를 발생시킬 수 있기 때문이며, 이는 여닫이문으로 설계된 도면을 보고 미닫이문으로 시공하는 것이다. SQL을 작성할 때는 각 속성의 Null 값 허용 여부를 반드시 확인해야 하고, 엔티티 간 관계(relationship)를 해석할 때에도 카디널리티(Crow's foot, 1:1, M:N 등) 만 보지 말고 Optionality를 반드시 따져봐야 한다.

설계 의도를 잘못 해석하면 데이터 품질뿐만 아니라 쿼리 성능에도 영향을 미칠 수 있다. 예를 들어, 그림2-17에서는 사원이 전혀 없는 유령 부서(또는 아직 부서원이 배정되지 않은 신규 부서)가 등록될 수 있다(부서 쪽 관계선이 점선). 따라서 사원 유무와 상관없이 모든 부서가 출력되도록 하려면 사원 쪽 모든 조건절에 Outer 기호(+)를 반드시 붙여줘야 한다.

![](/assets/images/sqlp/sqlp2-02-05-1-img2-17.png)

하지만 그림2-18에서는 사원 없는 부서가 등록될 수 없다(부서 쪽 관계선이 실선). 따라서 모든 부서가 출력되도록 하려고 굳이 Outer 조인할 필요가 없음에도 Outer 기호(+)를 붙인다면 성능이 나빠질 수 있는 것이다.

![](/assets/images/sqlp/sqlp2-02-05-1-img2-18.png)

그리고 그림 2-17과 2-18 모두 사원 쪽 부서 번호가 필수(Mandatory) 컬럼이다. 즉, 소속 부서 없는 사원이 존재할 수 없다는 뜻이므로 테이블을 생성할 때 Not Null 제약을 두어야 한다. DBMS에 실제 Not Null 제약을 생성했건 안했건 그 컬럼에 Null 값이 들어올 수 없도록 하려는 것이 설계자의 의도이므로 프로그램도 그에 맞게 개발해야 한다.

> 10. ERD 상에 표시된 설계자의 의도를 무시하고 테이블 생성시 Not Null 제약을 두지 않는 경우를 종종 보는데, 결코 바람직한 현상이 아니다. 데이터 품질이 중요하다는 것이 첫번째 이유고, 옵티마이저에게 매우 중요한 정보로서 성능에도 영향을 준다는 것이 두번째 이유다.

따라서 사원을 기준으로 부서 테이블과 Outer 조인 하는 것은 불 필 요 하 며, 만 약 Inner 조 인 을 했을 때 걸러지는 사원 레코드가 있다면 조회 프로그램이 아니라 입력/수정/삭제 프로그램을 고쳐야할 일이다. 물론 데이터 정제(cleansing) 작업도 함께 실시해야 한다. 그런데도 혹시 있을지 모를 Null 값을 두려워해 습관적으로 Outer 기호(+)를 붙인다면 성능상 불이익이 생길 수 있음을 명심하기 바란다.

### (2) Outer 소트머지조인

소트머지조인은 소트된 중간 집합을 이용한다는 점만 다를 뿐 처리 루틴이 NL 조인과 다르지 않다고 했다. 따라서 Outer 소트머지조인도 처리 방향이 한쪽으로 고정되며, Outer 기호(+)가 붙지 않은 테이블(Outer 테이블)이 항상 First 테이블로 선택된다. leading 힌트를 이용해 순서를 바꿔보려 해도 소용 없다.

![](/assets/images/sqlp/sqlp2-02-05-2-sql1.png)
